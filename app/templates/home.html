<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Livestock Marketplace</title>

<title>Afrik Livestock Marketplace</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {background-color: #f8f9fa; font-family: Arial, sans-serif;}
.navbar {background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
.search-bar {margin: 20px 0;}
.filter-panel {display: none; background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}

/* Product card */
.product-card {position:relative; background:#fff; border-radius:12px; overflow:hidden; transition:0.3s; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.product-card:hover {transform: translateY(-5px);}
.product-card img {width:100%; height:200px; object-fit:cover; border-top-left-radius:12px; border-top-right-radius:12px;}

/* Badges and wishlist */
.badge-overlay {position:absolute; top:10px; left:10px; display:flex; gap:5px; z-index:10;}
.badge-overlay span {padding:3px 7px; border-radius:5px; color:#fff; font-size:0.7rem; font-weight:bold;}
.wishlist-icon {position:absolute; top:10px; right:10px; background:#fff; border-radius:50%; padding:8px; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center;}
.wishlist-icon i {color:#d9534f; font-size:1.1rem;}
.wishlist-icon:hover {transform: scale(1.2); transition:0.2s;}

/* Product info */
.product-info {padding:12px;}
.product-info h5 {font-size:1rem; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.price {color:#28a745; font-weight:bold; margin-bottom:3px;}
.location {font-size:0.85rem; color:#555; margin-bottom:8px;}
.product-actions {display:flex; justify-content:start; gap:12px; margin-top:8px;}
.product-actions a {font-size:1.2rem; color:#333; transition:0.2s;}
.product-actions a:hover {color:#28a745;}

/* CTA */
.cta-apply {background-color: #28a745; color: #fff; font-weight: bold; padding: 10px; border-radius: 8px; text-align: center; display:block; margin-bottom:20px; text-decoration:none;}

/* Footer */
footer {background-color:#fff; padding:20px; text-align:center; margin-top:40px; box-shadow:0 -2px 4px rgba(0,0,0,0.05);}

/* Mobile bottom nav */
.bottom-nav {position:fixed; bottom:0; width:100%; background:#fff; border-top:1px solid #ddd; display:flex; justify-content:space-around; padding:10px 0; z-index:999;}
.bottom-nav a {text-align:center; font-size:0.8rem; color:#333; text-decoration:none;}
.bottom-nav a i {display:block; font-size:1.3rem;}

/* Mobile 2 column grid */
@media(max-width:767px){
  .col-6-mobile {padding-left:5px; padding-right:5px; width:50%;}
  .product-card img {height:150px;}
  .search-bar form {flex-direction:column; gap:8px;}
  .search-bar input {width:100% !important;}
  .search-bar button {width:100%;}
}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('main.home') }}">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Livestock Market" style="height:40px;">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        {% if current_user.is_authenticated %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('seller_dashboard.my_dashboard') }}">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Sign In</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.register') }}">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<!-- Search Bar -->
<div class="container search-bar d-flex justify-content-center">
  <form method="GET" class="d-flex align-items-center gap-2 w-100" style="max-width:600px;">
    <input type="text" name="search" class="form-control" placeholder="Search all products..." value="{{ request.args.get('search','') }}">
    <button type="button" class="btn btn-outline-secondary" id="toggleFilter"><i class="fas fa-filter"></i></button>
  </form>
</div>

<!-- Filter Panel -->
<div class="container filter-panel" id="filterPanel">
  <form method="GET">
    <div class="row g-3">
      <div class="col-md-3">
        <select name="category" class="form-select">
          {% set selected_category = request.args.get('category') %}
          <option value="">All Categories</option>
          <option value="cattle" {% if selected_category=='cattle' %}selected{% endif %}>Cattle</option>
          <option value="goats" {% if selected_category=='goats' %}selected{% endif %}>Goats</option>
          <option value="pig" {% if selected_category=='pig' %}selected{% endif %}>Pig</option>
          <option value="poultry" {% if selected_category=='poultry' %}selected{% endif %}>Poultry</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="state" name="state" class="form-select">
          <option value="">--Select State--</option>
          <option value="Lagos" {% if request.args.get('state')=='Lagos' %}selected{% endif %}>Lagos</option>
          <option value="Abuja" {% if request.args.get('state')=='Abuja' %}selected{% endif %}>FCT</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="city" name="city" class="form-select">
          <option value="">--Select LGA--</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="number" name="min_price" class="form-control mb-1" placeholder="Min Price" value="{{ request.args.get('min_price','') }}">
        <input type="number" name="max_price" class="form-control" placeholder="Max Price" value="{{ request.args.get('max_price','') }}">
      </div>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-primary">Apply Filters</button>
      <a href="{{ url_for('main.home') }}" class="btn btn-secondary">Reset</a>
    </div>
  </form>
</div>

<!-- CTA -->
<div class="container">
  <a href="#" class="cta-apply">Apply to become Agent / Vet / Logistics</a>
</div>

<style>
/* Fixed card image size and cropping */
.card-img-top {
    width: 100%;
    height: 200px;        /* uniform height */
    object-fit: cover;    /* crop/scale to fill */
}

@media (min-width: 768px) {
    .card-img-top {
        height: 250px;
    }
}

/* Carousel horizontal scroll on mobile */
.carousel-item .d-flex {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.carousel-item .card {
    flex: 0 0 auto;
}

/* Badge overlay */
.badge-overlay {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    gap: 5px;
    z-index: 10;
}

.badge-overlay span {
    color: white;
    padding: 2px 6px;
    font-size: 12px;
    border-radius: 3px;
}

/* Make all cards same height in grid */
.card.h-100 {
    display: flex;
    flex-direction: column;
}

.card-body {
    flex: 1 1 auto; /* grow to fill remaining space */
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* title/price on top, actions bottom */
}
</style>
<div class="container my-3">

  <!-- === All Products Scroll === -->
  {% if sorted_products %}
  <div class="row g-3 row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-6">
    {% for p in sorted_products %}
    <div class="col">
      <div class="card h-100 shadow-sm product-card position-relative">

        <!-- Badges -->
        {% if p.is_boosted %}
        <span class="badge bg-danger position-absolute top-0 start-0 m-2">Boosted</span>
        {% elif p.is_featured %}
        <span class="badge bg-primary position-absolute top-0 start-0 m-2">Featured</span>
        {% elif p.is_top %}
        <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">Top</span>
        {% endif %}

        <!-- Product Image -->
        <a href="{{ url_for('seller_dashboard.product_detail', product_id=p.id) }}">
          {% set photo = 'default.jpg' %}
{% if p.photos and p.photos[0] %}
    {% set photo = p.photos[0].split('uploads/')[-1] %}
{% endif %}
<img src="{{ url_for('static', filename='uploads/' ~ photo) }}"
     class="card-img-top"
     style="height: 200px; object-fit: cover;"
     alt="{{ p.title }}">

        </a>

        <!-- Card Body -->
        <div class="card-body d-flex flex-column">
          <h6 class="card-title text-truncate">{{ p.title }}</h6>
          <p class="mb-1 text-muted small">
            <i class="fas fa-map-marker-alt"></i>
            {{ p.state }}{% if p.city %}, {{ p.city }}{% endif %}<br>
            Posted: {{ p.created_at.strftime('%b %d, %Y') }}
          </p>
          <strong class="mt-auto">{{ "{:,.0f}â‚¦".format(p.price) }}</strong>

         <!-- Quick Action Buttons -->
<div class="mt-2 d-flex flex-wrap gap-1 justify-content-between">

  {% if p.owner.phone_number %}
    <!-- WhatsApp -->
    <a href="https://wa.me/{{ p.owner.phone_number | replace('0','234',1) }}"
       target="_blank"
       class="btn btn-success btn-sm flex-fill flex-md-auto d-flex align-items-center justify-content-center">
      <i class="fab fa-whatsapp me-1"></i>
      <span class="d-none d-md-inline">WhatsApp</span>
    </a>

    <!-- Call -->
    <a href="tel:{{ p.owner.phone_number }}"
       class="btn btn-primary btn-sm flex-fill flex-md-auto d-flex align-items-center justify-content-center">
      <i class="fas fa-phone me-1"></i>
      <span class="d-none d-md-inline">Call</span>
    </a>
  {% endif %}

  {% if p.owner %}
    <!-- Chat -->
    <a href="{{ url_for('chat.chat_with_user', receiver_id=p.owner.id) }}"
       class="btn btn-secondary btn-sm flex-fill flex-md-auto d-flex align-items-center justify-content-center">
      <i class="fas fa-comment me-1"></i>
      <span class="d-none d-md-inline">Chat</span>
    </a>
  {% endif %}

  {% if p.phone_display %}
    <!-- Hidden number button -->
    <div class="d-flex align-items-center gap-1 flex-fill flex-md-auto">
      <button class="btn btn-outline-primary btn-sm w-100" type="button"
              onclick="this.nextElementSibling.style.display='inline'; this.style.display='none';">
          <i class="fas fa-phone"></i> Call
      </button>

      <!-- Hidden number -->
      <a href="tel:{{ p.phone_display }}" class="text-decoration-none w-100" style="display: none;">
          <span>{{ p.phone_display }}</span>
      </a>
    </div>
  {% endif %}

  <!-- Product Details -->
  <a href="{{ url_for('seller_dashboard.product_detail', product_id=p.id) }}"
     class="btn btn-info btn-sm flex-fill flex-md-auto d-flex align-items-center justify-content-center">
    <i class="fas fa-eye me-1"></i>
    <span class="d-none d-md-inline">View</span>
  </a>

</div>

<style>
/* Make buttons smaller on mobile */
@media (max-width: 575px) {
  .btn-sm {
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
  }
  .btn-sm i {
    font-size: 0.9rem;
  }
}
</style>

<!-- Optional Hover Effect -->
<style>
.btn-sm {
  transition: transform 0.2s;
}
.btn-sm:hover {
  transform: scale(1.05);
}
</style>

        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-warning text-center">No products found.</div>
  {% endif %}
</div>

<!-- === Hover Effect CSS === -->
<style>
.product-card:hover {
  transform: scale(1.03);
  transition: transform 0.2s;
}
.card-img-top {
  width: 100%;
}
</style>



<!-- Footer -->
<footer>
  &copy; {{ now.year }} Livestock Marketplace. All rights reserved.
</footer>

<!-- Mobile Bottom Nav -->
<div class="bottom-nav d-md-none">
  <a href="{{ url_for('main.home') }}"><i class="fas fa-home"></i>Home</a>
  <a href="{{ url_for('main.home') }}"><i class="fas fa-search"></i>Search</a>
  <a href="{{ url_for('seller_dashboard.upload_product') }}"><i class="fas fa-plus-square"></i>Post</a>
  <a href="{{ url_for('chat.inbox') }}"><i class="fas fa-comment-dots"></i>Chat</a>
  <a href="{{ url_for('seller_dashboard.my_dashboard') }}"><i class="fas fa-user"></i>Profile</a>
</div>

<script>
  // Toggle filter panel
  const toggleBtn = document.getElementById('toggleFilter');
  const filterPanel = document.getElementById('filterPanel');
  toggleBtn.addEventListener('click',()=>filterPanel.style.display = filterPanel.style.display==='none'?'block':'none');

  // LGA logic
  const citySelect = document.getElementById("city");
  const stateSelect = document.getElementById("state");
  const lgasByState = {"Lagos":["Ikeja","Surulere"], "Abuja":["Garki","Maitama"]};
  stateSelect.addEventListener('change',()=>{
    citySelect.innerHTML = '<option value="">--Select LGA--</option>';
    if(lgasByState[stateSelect.value]) lgasByState[stateSelect.value].forEach(lga=>{
      let opt = document.createElement('option'); opt.value=opt.textContent=lga; citySelect.appendChild(opt);
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
