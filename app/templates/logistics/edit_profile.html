{% extends "logistics/base.html" %}
{% block content %}
<div class="container mt-4">
    <h3>Edit Your Profile</h3>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data">
        <div class="row mb-3">
            <div class="col-md-6">
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ user.first_name }}" class="form-control" required>
            </div>
            <div class="col-md-6">
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ user.last_name }}" class="form-control" required>
            </div>
        </div>

        <div class="mb-3">
            <label>Phone Number</label>
            <input type="text" name="phone" value="{{ user.phone }}" class="form-control" required>
        </div>

        <div class="mb-3">
            <label>Email</label>
            <input type="email" name="email" value="{{ user.email }}" class="form-control" readonly>
        </div>

        <div class="row mb-3">
            <div class="col-md-4">
                <label>State</label>
                <input type="text" name="state" value="{{ user.state }}" class="form-control">
            </div>
            <div class="col-md-4">
                <label>City</label>
                <input type="text" name="city" value="{{ user.city }}" class="form-control">
            </div>
            <div class="col-md-4">
                <label>Street</label>
                <input type="text" name="street" value="{{ user.street }}" class="form-control">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-control" name="company_name" value="{{ user.company_name }}">
        </div>

        <div class="mb-3">
            <label for="about" class="form-label">About</label>
            <textarea class="form-control" id="about" name="about">{{ user.about or '' }}</textarea>
        </div>

        <!-- Profile Photo -->
        <div class="mb-3">
            <label>Profile Photo</label><br>
            {% if user.profile_photo %}
                <!-- Since Cloudinary URL is already stored, no need for url_for -->
                <img id="profile-preview" src="{{ user.profile_photo }}"
                     class="img-thumbnail mb-2" style="max-height: 150px;">
            {% else %}
                <img id="profile-preview" src="{{ url_for('static', filename='default_profile.png') }}"
                     class="img-thumbnail mb-2" style="max-height: 150px;">
            {% endif %}
            <input type="file" name="profile_photo" class="form-control" onchange="previewImage(event)">
        </div>

        <button class="btn btn-primary">Update Profile</button>
    </form>
</div>

<!-- Preview Script -->
<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('profile-preview');
        output.src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
}
</script>
{% endblock %}
