<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .profile-container { max-width: 700px; margin: 30px auto; }
    .profile-photo { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; }
    .review-stars { font-size: 0.9rem; }
    .review-item { padding: 0.5rem; margin-bottom: 0.3rem; border-radius: 0.25rem; background: #f1f1f1; }
    .agent-info { display: flex; align-items: center; gap: 1rem; }
    .agent-details h3 { margin-bottom: 0.3rem; }
    .badge-kyc { font-size: 0.8rem; }
  </style>
</head>
<body>

<div class="container profile-container bg-white p-4 rounded shadow-sm">

  <!-- Agent Header -->
  <div class="agent-info mb-3">
    {% if agent.profile_photo %}
      <img src="{{ url_for('static', filename=agent.profile_photo) }}" alt="Profile Photo" class="profile-photo">
    {% else %}
      <img src="{{ url_for('static', filename='default_profile.png') }}" alt="Profile Photo" class="profile-photo">
    {% endif %}

    <div class="agent-details">
      <h3 class="d-flex align-items-center">
        {{ agent.first_name }} {{ agent.last_name }}
        {% if agent.kyc and agent.kyc.status == 'approved' %}
          <span class="ms-2 text-primary" title="Verified">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" style="width:20px; height:20px;">
              <path d="M22.5 12c0 5.8-4.7 10.5-10.5 10.5S1.5 17.8 1.5 12 6.2 1.5 12 1.5 22.5 6.2 22.5 12zm-11 4.8l6.3-6.3-1.4-1.4-4.9 4.9-2.1-2.1-1.4 1.4 3.5 3.5z"/>
            </svg>
          </span>
        {% endif %}
      </h3>
      <span class="badge badge-kyc {% if agent.kyc and agent.kyc.status=='approved' %}bg-success{% else %}bg-secondary{% endif %}">
        {% if agent.kyc and agent.kyc.status=='approved' %}Verified{% else %}Unverified{% endif %}
      </span>
      <p class="mb-0"><strong>Company:</strong> {{ agent.company_name or '-' }}</p>
      <p class="mb-0"><strong>Location:</strong> {{ agent.street }}, {{ agent.city }}, {{ agent.state }}</p>
      <p class="mb-0"><strong>Email:</strong> {{ agent.email }}</p>
      <p class="mb-0"><strong>Phone:</strong> {{ agent.phone }}</p>
      <p class="mb-0"><span class="badge bg-warning text-dark">⭐ {{ average_rating }} ({{ total_reviews }} reviews)</span></p>
    </div>
  </div>

  <!-- Reviews Section -->
  {% if total_reviews > 0 %}
    <div class="mb-3">
      <h5>Agent Rating Summary</h5>
      <div class="mb-2">
        {% set full_stars = average_rating|round(0, 'floor')|int %}
        {% set empty_stars = 5 - full_stars %}
        <span class="text-warning review-stars">
          {% for _ in range(full_stars) %}★{% endfor %}
          {% for _ in range(empty_stars) %}☆{% endfor %}
        </span>
        <small class="text-muted">({{ total_reviews }} review{{ 's' if total_reviews != 1 else '' }})</small>
      </div>
    </div>

    {% if positive_reviews %}
      <div class="mb-2">
        <h6 class="text-success">Positive Reviews</h6>
        {% for review in positive_reviews %}
          <div class="review-item">
            <div class="d-flex justify-content-between">
              <strong>{{ review.reviewer.first_name }}</strong>
              <small class="text-muted">{{ review.created_at.strftime('%d %b, %Y') }}</small>
            </div>
            <div class="text-warning review-stars">
              {% for _ in range(review.rating) %}★{% endfor %}
              {% for _ in range(5 - review.rating) %}☆{% endfor %}
            </div>
            <p class="mb-0">{{ review.comment }}</p>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if negative_reviews %}
      <div class="mb-2">
        <h6 class="text-danger">Negative Reviews</h6>
        {% for review in negative_reviews %}
          <div class="review-item">
            <div class="d-flex justify-content-between">
              <strong>{{ review.reviewer.first_name }}</strong>
              <small class="text-muted">{{ review.created_at.strftime('%d %b, %Y') }}</small>
            </div>
            <div class="text-warning review-stars">
              {% for _ in range(review.rating) %}★{% endfor %}
              {% for _ in range(5 - review.rating) %}☆{% endfor %}
            </div>
            <p class="mb-0">{{ review.comment }}</p>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% else %}
    <p class="text-muted">No reviews yet.</p>
  {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
